# ffs

**Friendly Following Sudo** (or, let's be honest, the more colorful interpretation)

`ffs` is a zsh shell function that reruns the previous command with sudo privileges. Because we've all been there: you run a command, it fails with a permission error, and you just want to say... well, you know.

## Installation

1. Clone or download this repository
2. Source `ffs.zsh` in your `.zshrc`:

```bash
echo "source /path/to/ffs.zsh" >> ~/.zshrc
```

3. Reload your shell:

```bash
source ~/.zshrc
```

## Usage Examples

### Basic Usage

The most common scenario - you forgot to use sudo:

```bash
$ rm /etc/important-system-file
rm: cannot remove '/etc/important-system-file': Permission denied

$ ffs
$ sudo sh -c 'rm /etc/important-system-file'
```

### Same-Line Usage

Save a keystroke by using `ffs` on the same line:

```bash
$ apt update; ffs
$ sudo sh -c 'apt update'
```

### Command Chains

`ffs` works with entire command chains:

```bash
$ cd /root && ls -la
cd: permission denied: /root

$ ffs
$ sudo sh -c 'cd /root && ls -la'
```

### Recursion Guard

`ffs` includes built-in protection against recursion. If there's no valid previous command, it will let you know:

```bash
$ ffs
Error: No valid previous command found
```

## How It Works

`ffs` leverages zsh's `fc` (fix command) built-in to access your shell history:

1. **Same-line detection**: First checks if `ffs` was invoked on the same line as another command (e.g., `command; ffs`) by examining the current history entry
2. **Previous command retrieval**: If not same-line, retrieves the previous command from history using `fc -ln -2`
3. **Recursion prevention**: Validates that the command isn't `ffs` itself
4. **Execution**: Runs the entire command chain under `sudo sh -c`, preserving command structure and operators

The use of `sudo sh -c` ensures that complex commands with pipes, redirections, and other shell operators work correctly under sudo.

## Requirements

- zsh shell
- sudo privileges on your system

## License

Licensed under the Apache License, Version 2.0. See [LICENSE](LICENSE) for details.

## Contributing

This project was generated by [Terragon Labs](https://terragon.dev) as part of an AI-aligned git toolset.

Contributions are welcome! Please feel free to submit issues or pull requests.

### Guidelines

- Follow the existing code style
- Test your changes with the included `test_ffs.sh` script
- Keep the function simple and focused on its core purpose
- Update documentation for any new features

## Related

Part of the [ai-aligned-git](https://github.com/trieloff/ai-aligned-git) project.
